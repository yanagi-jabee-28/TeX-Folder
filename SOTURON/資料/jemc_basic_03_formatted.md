# Sパラメータ活用術

**TDK EMC Technology 基礎編**

TDK株式会社　アプリケーションセンター　藤城　義和

---

## 1 Sパラメータとは何か

電子回路の高速化に伴い、デジタル回路設計においてもアナログ的な性質が重視されてきています。そのため、従来はやや特殊な扱いであったSパラメータも、今また注目が集まっています。ここでは、Sパラメータとは、どのようなものかを簡単に解説します。

### ■Sパラメータの定義

Sパラメータ（Scattering parameter）とは、交流信号を波と捉えたとき、その波動の反射や伝送度合いで回路の特性を表わしたものです。度合いというのは、対象となる回路を反射または通過する波がどの程度、減衰されて、あるいは増幅されて伝わるかということです。対象回路のポート（出入り口）に番号を付け、｢ポートjに入射→ポートiで検出｣ されるSパラメータを$S_{ij}$と記します。$i=j$の場合は反射、$i \neq j$の場合は伝送を表わします。図1にレンズに光を当てたときとの類推で説明してあります。詳細な定義は教科書など［1－6］を参照ください。

フィルタ特性などでは、「挿入損失」という言い方も散見されますが、それは $|S_{21}|$ とほぼ同じものと考えてよいでしょう。入出力で終端条件が異なったときは、$|S_{21}|$ と挿入損失は違った値になります（ただし換算可能）が、そのようなケースはそう多くはありません。ただし、符号には注意が必要です。Sパラメータが ｢対象量/基準量｣ という定義なのに対して、挿入損失は ｢基準量/対象量｣ で定義されています。つまり、逆数の関係にあるのです。そのため、対数（dB単位）をとったときに±が反対になります（例えば $|S_{21}| = -20\text{dB}$ のことを、挿入損失＝+20dBと言います)。挿入損失は負を嫌った定義で、一方、Sパラメータは増幅されたときに＋で、減衰されたときに－になるような定義というわけです。

> **[図1の説明]:** Sパラメータの概念図（光との類推）。
> 左側から「入射 $a_1$」の波が対象物（レンズのような形状）に入り、一部が「反射 $b_1$」として戻り、残りが「透過、伝送 $b_2$」として右側へ抜けていく様子が描かれている。
> - $S_{11} = b_1 / a_1$ （反射係数）
> - $S_{21} = b_2 / a_1$ （伝送係数）

### ■Sパラメータの特徴

Sパラメータは電力の比（正確にはその平方根を取ったもの）なので、無次元量です（単位がありません）。しかし、その大きさを言う場合、常用対数をとって、dB単位で表わすのが普通です$^{*1}$。参考のため、表1に代表的な値を載せておきました。Sパラメータが $1/\sqrt{2}$ の場合、すなわち半分の電力が伝送（または反射）される場合、$-3\text{dB}$ になります。

**表1　Sパラメータの代表的な値**

| $|S_{ij}|$ | $20\log|S_{ij}|$ |
| :--- | :--- |
| 1 | 0 dB |
| $1/\sqrt{2}$ | $-3$ dB |
| $1/10$ | $-20$ dB |
| $1/100$ | $-40$ dB |
| $1/1000$ | $-60$ dB |

Sパラメータのいくつかの特徴を列挙します。

*   2ポートの受動回路では、$|S_{11}|^2 + |S_{21}|^2 \leqq 1$ が成り立ちます。従って、受動部品のSパラメータは1（0dB）を越えません。等号（Feldtkellerの公式）は無損失の場合です。損失がないので全割合を足せば100%になるということを表わしています。
*   可逆な部品（受動部品で言えばアイソレータやサーキュレータなど一方向系でないもの）では、$S_{21}=S_{12}$ が成り立ちます。一般には、$S_{ij}=S_{ji}$ です（S行列が対称行列）。ミックスト・モードSパラメータ（次単元参照）でも同様に、$S_{cc21}=S_{cc12}$、$S_{dc11}=S_{cd11}$、$S_{dc21}=S_{cd12}$ などが成り立ちます。

---
$^{*1}$ ここでは煩雑さを避けるため、「$S_{21}$の絶対値（あるいは単に$S_{21}$）が○○dB」といった表現を使ってしまいますが、本来は、$20\log|S_{21}|=$○○dBとするべきでしょう。単位としてdBが付いている数値は、"20log" （場合によっては"10log"）をとった量であることを暗黙のうちに示しています。ちなみに、～損失（例えば挿入損失）、～減衰量、～ loss（例えばLCL）という用語は、はじめからdB単位のパラメータとして定義されています（従って真数で表わすことはない）。

---

## 2 Sパラメータを使う

Sパラメータは、最近ではネットワークアナライザという測定器を使って測定するのが一般的です。そのデータを保存する際、後に数値としてやり取りしたり、シミュレータで使ったりする予定があるならば、いわゆるTouchstone形式（のテキストファイル）にしておくと便利です（例を図2に示します）。

> **[図2の説明]:** Touchstoneファイルの例。
> テキスト形式で周波数ごとのSパラメータデータが記述されている。
> ヘッダー行: `# MHz S MA R 50` （周波数単位MHz、Sパラメータ、Magnitude/Angle形式、基準抵抗50Ω）
> データ行の例:
> `0 0.005 0 0.994 0 0.994 0 0.005 0`
> `0.300 0.999 -0.037 0.002 89.72 0.002 89.72 0.999 -0.023`
> ...
> `6000 0.178 -107.7 0.972 -16.48 0.972 -16.48 0.182 -101.8`

### ■基準インピーダンス

Sパラメータを使う上で、あるいは理解する上で重要な概念に基準インピ－ダンスというものがあります。以下に概説します。

Sパラメータの値を示すとき、単純に$S_{21}$が○○dBとか言ったりしますが、本来は、△△Ωを基準にしたときの$S_{21}$が○○dBと言う必要があります。たいていの場合、50Ω基準なので省略しても問題はないのですが、何かを基準にしたときの言わば相対値だということを忘れてはなりません。Sパラメータを取得（測定やシミュレーションで）した際の基準値が、必ず付属しているのです。

基準というのは次のような意味です。1ポートのSパラメータ、すなわち反射係数で考えてみましょう。反射係数はインピーダンス $Z$ と、

$$
\Gamma = \frac{Z - Z_0}{Z + Z_0}
$$

という関係があります。この式で出てくる $Z_0$ が、基準インピーダンスです。例えば、50Ωと200Ωの2つの抵抗器があったとします。$Z=50\Omega$ を $Z_0=50\Omega$ 基準で反射係数に直せば、$\Gamma=0$ です。同様に、$Z=200\Omega$ ならば、$\Gamma=0.6$ になります。もし、$Z_0=200\Omega$ 基準ならば、$Z=50\Omega$ は $\Gamma=-0.6$ で、$Z=200\Omega$ が $\Gamma=0$ です。つまり、50Ωの抵抗は、50Ω基準のとき反射しない（整合、$\Gamma=0$）し、200Ωの抵抗は、200Ω基準のとき反射しないわけです。このように反射係数は相手によって値が変化する相対値なのです。基準インピーダンスというのは、その相対値の基準となるものという意味です。1ポート以外の場合も事情は同じですが、式は少々複雑です［5、6］。

50Ωというのが基準値である以上、50Ω以外のSパラメータというのも存在します（上記のように）。しかも単なる基準値なので、変更可能です。つまり、50ΩのときのSパラメータがわかっていれば、それ以外の基準インピーダンスでのSパラメータに直すことができます（注意：$S_{21}$ だけが知りたい場合でも、元のSパラメータは全て（$S_{11}$、$S_{21}$、$S_{12}$、$S_{22}$）必要）。手計算するのは大変ですが、高周波シミュレータなどを使えば、簡単に結果は得られます（図3）。TDK製の「SEAT」でも計算可能です。図4はそれを使って、series-thru配置のビーズのSパラメータを10、50、100Ω基準で描いたものです。基準インピーダンスが小さいほど、減衰能力が高いことがわかります。shunt-thruのコンデンサは、ここには図示しませんが、その逆で、高インピーダンスほど減衰能力が高くなります。

> **[図3の説明]:** 基準インピーダンスの変更方法。
> 中央に「元の回路」があり、その左右に理想トランスが接続されている。
> 左側（ポート1）のトランス比は $n:1$、右側（ポート2）のトランス比は $1:n$。
> $n = \sqrt{Z_0 / Z'_0}$ （$Z_0$は元の基準インピーダンス（通常50Ω）、$Z'_0$は希望の基準インピーダンス）。
> 以下の回路を $Z_0$ 終端でシミュレーションする。
> 理想トランスはインピーダンスを定数倍（$n^2$倍）する作用がある。
> シミュレータによっては終端インピーダンスを自在に替えられるものもあるが、それを使えばこのような工夫は必要ない。

> **[図4の説明]:** 基準インピーダンスを変更したときのビーズのSパラメータ。
> 横軸は周波数（1E+2 Hz ～ 1E+4 Hz）、縦軸は減衰量（dB）。
> $|S_{21}|$ のグラフが3本描かれている。
> 矢印は基準インピーダンスの増える（10Ω→50Ω→100Ω）方向を示しており、インピーダンスが低いほど減衰量が大きい（グラフが下にある）ことを示している。
> $|S_{11}|$ のグラフも同様に描かれている。

### ■ミックスト・モードSパラメータ

次にミックスト・モードSパラメータについて考えてみます。例えば、差動伝送はディファレンシャルモードやコモンモードといったモード（コラム参照）を利用したシステムですが、その場合、Sパラメータもそういったモード空間で考える必要があります。それがミックスト・モードSパラメータ（modal Sパラメータ）です。通常のSパラメータ（これをミックスト・モードSパラメータに対して、シングルエンデッドSパラメータあるいはnodal Sパラメータと言う）はポートごとの応答を表わしているのですが、ミックスト・モードSパラメータは2つのポートの和信号（コモンモード）や差信号（ディファレンシャルモード）の応答を表わしています。

ミックスト・モードSパラメータはシングルエンデッドSパラメータから求めることができます（図5）。計算式は少々複雑ですが、シミュレータなどで計算できます（図6、［7］）。最近では直読できるネットワークアナライザも多数あります。求まったミックスト・モードSパラメータは次のような意味があります。詳細は文献［6、8］を参照してください。

*   $S_{ccij}$：コモンモードの応答
*   $S_{ddij}$：ディファレンシャルモードの応答
*   $S_{dcij}$、$S_{cdij}$： ディファレンシャルモード⇔コモンモード間のモード転換量

> **[図5の説明]:** ミックスト・モードSパラメータはシングルエンデッドSパラメータから変換可能であることを示す図。
> 左側：シングルエンデッドSパラメータ（4ポート回路）。ポート1, 2, 3, 4があり、S行列 $S$ は $4 \times 4$ の行列（$S_{11}$～$S_{44}$）。
> 矢印で変換を示し、右側へ。
> 右側：ミックスト・モードSパラメータ。ポートC1, D1, C2, D2に対応。
> S行列 $S'$ は以下の要素を持つ $4 \times 4$ 行列。
> - 左上ブロック: $S_{cc11}, S_{cc12}, S_{cc21}, S_{cc22}$ （コモンモード）
> - 右上ブロック: $S_{cd11}, S_{cd12}, S_{cd21}, S_{cd22}$ （モード変換）
> - 左下ブロック: $S_{dc11}, S_{dc12}, S_{dc21}, S_{dc22}$ （モード変換）
> - 右下ブロック: $S_{dd11}, S_{dd12}, S_{dd21}, S_{dd22}$ （ディファレンシャルモード）

モード転換量（$S_{dcij}$や$S_{cdij}$）は系の対称性の指標となります［9、10］。対称性が良ければゼロ、つまり、各モードが独立します。ちなみに、LCL$^{*2}$は、Sパラメータを用いて、

2ポート回路　$LCL_1 := -20\log|2S_{dc}| = -20\log|S_{11} - S_{21} + S_{12} - S_{22}|$
4ポート回路　$LCL_2 := -20\log|2S_{dc11}| = -20\log|S_{11} - S_{31} + S_{13} - S_{33}|$

と表わされます［7、11、12］。

図7はコモンモードフィルタ（CMF）の実測例です。このCMFは、100MHz付近のコモンモードを抑制する（$|S_{cc21}| = -30\text{dB}$）が、ディファレンシャルモードは素通り（$|S_{dd21}| = 0\text{dB}$）であることが読み取れます。

> **[図6の説明]:** ミックスト・モードSパラメータの計算方法。
> 中央に「元の回路」（4ポート）がある。
> 左側（ポート1, 3）と右側（ポート2, 4）にそれぞれ変換回路が接続されている。
> 変換回路は行列 $S = \begin{bmatrix} 0 & Q \\ Q & 0 \end{bmatrix}$ で表され、$Q = \frac{1}{\sqrt{2}} \begin{bmatrix} 1 & 1 \\ 1 & -1 \end{bmatrix}$ である。
> 入力側ポートは $e_1, o_1$、出力側ポートは $e_2, o_2$ となっている。
> - 以下の回路を $Z_0$ 終端でシミュレーションする。
> - 両脇の回路はシングルエンデッドからミックスト・モードに変換する作用がある（対称なので、その逆の作用もある）。
> - この変換回路は理想マジックTなので、理想トランス網（ハイブリッドコイル）を使って表現することもできる［7］。

> **[図7の説明]:** CMFのミックスト・モードSパラメータの例。
> 横軸は周波数（1E-1 ～ 1E+4 MHz）、縦軸は絶対値（dB）。
> - $|S_{dd21}|$（赤線）: ほぼ0dBで平坦（ディファレンシャルモードは通過）。
> - $|S_{cc21}|$（青線）: 100MHz付近で大きく減衰（-30dB程度）（コモンモードは抑制）。
> - $|S_{cd21}|, |S_{dc21}|$（緑線、紫線）: -40dB以下で低い（モード変換は少ない）。

---
$^{*2}$ ITU-T Recommendation G.117-1996 “Transmission aspects of unbalance about earth” では、2ポート回路と4ポート回路（規格の中ではそれぞれ1ポート、2ポートと称されている）に対してLCLが定義されています。ここでは、混乱を避けるため便宜的に、それぞれ、$LCL_1$、$LCL_2$と書くこととします。$LCL_2$は着目していないポートを基準インピーダンスで終端したときの$LCL_1$です。LCLは、信号源電圧を基準に取っているので、Sパラメータとは2倍（6dB）違うことになります（本文の式にはそれが反映されている）。

---

### 参考文献

［1］太田勲，｢電磁波回路のSパラメータによる表現とその基本特性｣，MWE（Microwave Workshops & Exhibition）'97 Digest，pp.427-436，1997 December
［2］荒木純道，｢Sパラメータに基づく電磁波回路の解析と設計｣，MWE（Microwave Workshops & Exhibition）'97 Digest，pp.437-445，1997 December
［3］高橋秀俊,藤村靖，「高橋秀俊の物理学講義 -物理学汎論-」，丸善，1990
［4］中島将光，「マイクロ波工学」，森北出版，1975
［5］Kaneyuki KUROKAWA, "Power waves and the scattering matrix", IEEE Trans. MTT, vol.MTT-13, No.2, pp.194-202, 1965 March
［6］藤城義和，｢Sパラメータによる電子部品の評価｣，TDKアプリケーションノートAN-SP06A001_ja，2006（http://www.tdk.co.jp/tvcl/spara/an-sp06a001_ja.pdf）
［7］藤城義和,福永達也，「電子部品のマルチポート測定 -高速デジタル回路用EMC対策部品のモデリング-」，MWE（Microwave Workshops & Exhibition） 2007 Digest，pp.193-198，2007 November （この予稿集にあるLCLの式（（4）式と（7）式）は間違えている。正しい式はこの原稿の本文参照）
［8］David E.BOCKELMAN, William R.EISENSTADT, “Combined differential and common-mode scattering parameters : Theory and simulation”, IEEE Tarns. MTT, vol.43, No.7, pp.1530-1539, 1995 July
［9］藤城義和，「Sパラメータによるコモンモードフィルタの解析」，信学技報 EMCJ，pp.25-30，2000 September （EMCJ2000-60）
［10］藤城義和,梅村哲也，「IEEE1394とUSBの雑音対策,対策部品の評価に死角あり」，日経エレクトロニクス，No.784，pp.214-220，2000年12/4号とNo.785，pp.218-223，2000年12/18号の2回連載
［11］藤城義和，「Sパラメータによるコモンモードフィルタの評価」，第9回日経ボード情報フォーラム"GHz時代の電子機器のEMC設計･測定･評価技術"，2002.2.13開催
［12］K.Yanagawa, J.Cross, ”Modal Decomposition（Non-Balun） Measurement Technique: Error Analysis and Application to UTP/STP Characterization to 500MHz”, International Wire and Cable Symposium Proceedings, pp.126-133, 1995 November
［13］（著）Clayton R. PAUL，（監修）佐藤利三郎，（監訳）櫻井秋久，「EMC概論」，ミマツデータシステム，1996；Clayton R. PAUL, "Introduction to Electromagnetic Compatibility", John Wiley & Sons, 1992（初版），2006（第2版）

---

## コモンモードとは何か

EMCの問題を考える上で、｢コモンモード｣ は1つのキーワードになっています。そこで、本コラムではコモンモードを徹底解剖してみました。

### ■コモンモードとディファレンシャルモードの定義

差動伝送のように、平行に走っている2本の導体（とGND導体）を想定します。その導体の電圧、電流をそれぞれ、$V_1$、$I_1$、$V_2$、$I_2$とする（図1参照）と、コモンモード電圧$V_c$、電流$I_c$、そしてディファレンシャルモード電圧$V_d$、電流$I_d$は次のように定義されます（IEC用語規格 IEC60050-161:1990、JIS C0161:1997）。

*   **コモンモード電圧$V_c$：** 各導体の電圧の平均
    $V_c = (V_1 + V_2) / 2$
*   **コモンモード電流$I_c$：** 各導体の電流の和
    $I_c = I_1 + I_2$
*   **ディファレンシャルモード電圧$V_d$：** 2導体間の電圧
    $V_d = V_1 - V_2$
*   **ディファレンシャルモード電流$I_d$：** 各導体の電流の差の半分
    $I_d = (I_1 - I_2) / 2$

コモンモードが和信号、ディファレンシャルモードが差信号を表わしていることがわかります。ディファレンシャルモード電流は2導体を逆向き（逆相）に流れる電流成分ですので、GNDは直接関与していません（そのためノーマルモードと言うこともあります）。一方、コモンモード電流は2導体を同じ向き（同相）に流れる電流成分です。従って、行った電流はGND導体（またはどこか別のところ）を通って帰ってきます（そのため地回線と言ったりもします）。
コモンモードのことをasymmetrical（反対称）あるいは「縦（例えば縦電流）、longitude」、ディファレンシャルモードのことをsymmetrical（対称）あるいは「横」と称することもあります。

> **[図1の説明]:** 平行2導体線路の図。
> 上の導体に電圧 $V_1$、電流 $I_1$。
> 下の導体に電圧 $V_2$、電流 $I_2$。
> 下部にGNDを示す記号がある。

### ■他のモードもある

コモン、ディファレンシャルモードの親戚にeven（偶）、odd（奇）モードがあります。これらは、同様に和信号、差信号を表わしているのですが、係数が違います。式で書けば、

*   **evenモード電圧$V_e$、電流$I_e$：**
    $V_e = (V_1 + V_2) / \sqrt{2}$
    $I_e = (I_1 + I_2) / \sqrt{2}$
*   **oddモード電圧$V_o$、電流$I_o$：**
    $V_o = (V_1 - V_2) / \sqrt{2}$
    $I_o = (I_1 - I_2) / \sqrt{2}$

です。
evenモードはコモンモードと比べて、電圧が $\sqrt{2}$ 倍で、電流が $1/\sqrt{2}$ になっています。例えば、$I_1=1\text{A}$、$I_2=1\text{A}$の場合、コモンモード電流で言えば、$I_c=2\text{A}$ですが、evenモード電流では$I_e=\sqrt{2}\text{A}$となります。同じ和信号を表わしているので、定性的には同じですが、定量的には異なってきます（例えて言えば、同じ面積でも「m$^2$単位」で言うのと「坪」で言うのとで違うようなもの）。電圧、電流が違うので、その比であるインピーダンスも違ってきます。電圧が $\sqrt{2}$ 倍で、電流 $1/\sqrt{2}$ がなので、その比はちょうど2倍違うことになります（ちなみに積である電力は $\sqrt{2} \times 1/\sqrt{2} = 1$ で変わりません）。従って、evenモードで50Ωというのは、コモンモードでは25Ωに相当しています。oddモードとディファレンシャルモードの関係も同様です。oddモードで50Ωというのは、ディファレンシャルモードでは100Ωに相当しています。コモンモードが25Ω（半分）というのは、その定義が並列接続を表わしているからです。例えば、対称な2本の伝送線路の場合、そのコモンモード特性は図2のように表現できます。50Ωの線路を並列接続したので、25Ωになります。同様にディファレンシャルモードの定義は直列接続を表わしています。

このように微妙な違いのある2つの用語ですが、それぞれに特長があり使い分けられています。even、oddモードは、変換してもインピーダンスが変わらないなどの性質があり、理論構成が楽です。そのため、マイクロ波の分野などで多く用いられています。その代わり、$\sqrt{2}$ などの無理数が入ってくるので、扱いには少々難があります。そこで、実用的にはコモン、ディファレンシャルモードが用いられます。例えば、平衡ケーブルの特性インピーダンスを100Ωなどと称しますが、それは（oddモードではなく）ディファレンシャルモードの特性インピーダンスを指しています。

> **[図2の説明]:** 対称な2本の伝送線路の並列接続。
> 2本の線路（それぞれ25Ωと記載されているが、本文の説明から50Ωの線路を並列にして25Ωになることを示していると思われる）が並列に接続されている図。

### ■コモンモードは放射ノイズの源

ディファレンシャルモード電流は2導体の往復電流なので、帰路は往路に近接（いわゆるループ面積が小さい）しています。そのため、遠方から見た場合、それらが相殺されて、ほとんど電流が流れていないように見えます。一方、コモンモード電流は先に書いたように、帰路が不定で、遠くを通ることもあります。そのため、ループ面積が大きく、放射ノイズの元になりやすいと言えます［13］。
コモン、ディファレンシャルモードは平行2導体のような系で定義されています。従って、それ以外の、例えば面内の電流分布などでは使えないのですが、一般に、理想的な往復電流からずれた（ループ面積が大きく放射ノイズの元になりそうな）ものを、その類似性からコモンモードと称してしまうことが多いようです。しかし、その場合は定義が曖昧なので誤解を生じないよう注意が必要です。